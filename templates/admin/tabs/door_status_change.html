<!-- 문 상태 변경 탭 -->
<div class="tab-pane fade"
     id="door-status-change" 
     role="tabpanel" 
     aria-labelledby="door-status-change-tab">
    <h3 class="h4 h-lg-3">문 상태 변경</h3>
    <hr>

    <form id="door-status-form">
        <div class="mb-3">
            <label for="button" class="form-label">버튼 사용</label>
            <select class="form-select" id="button" name="button">
                <option value="1" {% if door_status.button %}selected{% endif %}>활성화</option>
                <option value="0" {% if not door_status.button %}selected{% endif %}>비활성화</option>
            </select>
        </div>
        
        <div class="mb-3">
            <label for="auth_code" class="form-label">QR 사용</label>
            <select class="form-select" id="auth_code" name="auth_code">
                <option value="1" {% if door_status.auth_code %}selected{% endif %}>활성화</option>
                <option value="0" {% if not door_status.auth_code %}selected{% endif %}>비활성화</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="nfc" class="form-label">NFC 사용</label>
            <select class="form-select" id="nfc" name="nfc">
                <option value="1" {% if door_status.nfc %}selected{% endif %}>활성화</option>
                <option value="0" {% if not door_status.nfc %}selected{% endif %}>비활성화</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="status" class="form-label">문 상태</label>
            <select class="form-select" id="status" name="status">
                <option value="open" {% if door_status.status == 'open' %}selected{% endif %}>열림</option>
                <option value="close" {% if door_status.status == 'close' %}selected{% endif %}>닫힘</option>
                <option value="restrict" {% if door_status.status == 'restrict' %}selected{% endif %}>잠금</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">상태 변경</button>
    </form>

    <pre id="door-status-result" class="mt-3 text-danger"></pre>
</div>

<script>
const CURRENT_USER_UUID = "{{ current_user_uuid|default('') }}";

document.getElementById('door-status-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = {
        auth_code: parseInt(document.getElementById('auth_code').value),
        button: parseInt(document.getElementById('button').value),
        nfc: parseInt(document.getElementById('nfc').value),
        status: document.getElementById('status').value,
        user_uuid: CURRENT_USER_UUID
    };

    fetch('/admin/door/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    }) 
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                showErrorToast('문 상태 수정 실패: ' + data.detail);    
            } else {
                showSuccessToast('문 상태를 수정했습니다.');
            }
            reloadPage();
        })
        .catch(err => {
            console.error(err);
            showErrorToast('문 상태 수정 중 오류가 발생했습니다.');
            reloadPage(1500);
        });
});
</script>
